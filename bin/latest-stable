#!/usr/bin/env bash

# This script safely fetches the latest STABLE version of mvnd.
# It uses the official GitHub API and jq for reliable JSON parsing.

set -euo pipefail

get_latest_stable_mvnd() {
    # 1. Fetch all releases from the mvnd repository via GitHub's API.
    # 2. Use jq to parse the JSON response:
    #    - .[] iterates over each release object in the array.
    #    - select(.prerelease == false) filters out any release marked as a pre-release (e.g., "2.0.0-rc-3").
    #    - .tag_name extracts only the version number string.
    # 3. The -r flag on jq provides the raw string output without quotes.
    curl -s "https://api.github.com/repos/apache/maven-mvnd/releases" \
        | jq -r '.[] | select(.prerelease == false) | .tag_name'
}

# Execute the function, sort the versions from newest to oldest, and print the top one.
get_latest_stable_mvnd | sort --version-sort --reverse | head -n 1